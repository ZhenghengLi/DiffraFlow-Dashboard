<div class="monitor">
    <div class="header">
        <label>Current calibrated image and related analysis results</label>
    </div>
    <div class="row-container">
        <div class="image">
            <app-image-card [energyRange]="imageEnergyRange" [imageData]="imageData"> </app-image-card>
        </div>
        <div class="metadata">
            <div class="control">
                <div class="button-group">
                    <button class="start" (click)="imageFetcherStart()" [disabled]="runningFlag">Start</button>
                    <button class="stop" (click)="imageFetcherStop()" [disabled]="!runningFlag">Stop</button>
                </div>
                <label class="interval"
                    >Interval Time:
                    <input class="interval" [(ngModel)]="intervalTime" [disabled]="runningFlag" />
                    ms
                </label>
                <label *ngIf="runningFlag; else statusStopped" class="status running"> RUNNING </label>
                <ng-template #statusStopped>
                    <label class="status stopped">STOPPED</label>
                </ng-template>
            </div>
            <div class="image-meta">
                <table>
                    <tr>
                        <th class="col1">Update Time</th>
                        <td class="col2">
                            <ng-container *ngIf="updateTime">
                                {{ updateTime | date: "yyyy-MM-dd, HH:mm:ss.SSS" }}
                            </ng-container>
                        </td>
                        <th class="col3">Bunch ID</th>
                        <td class="col4">
                            <ng-container *ngIf="imageMeta">
                                {{ imageMeta.bunch_id }}
                            </ng-container>
                        </td>
                    </tr>
                    <tr>
                        <th class="col1">Calibration Level</th>
                        <td class="col2">
                            <ng-container *ngIf="imageMeta">
                                {{ imageMeta.calib_level }}
                            </ng-container>
                        </td>
                        <th class="col3">Late Arrived</th>
                        <td class="col4">
                            <ng-container *ngIf="imageMeta">
                                {{ imageMeta.late_arrived }}
                            </ng-container>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="analysis">
                <div class="feature">
                    <label>Image Features</label>
                    <div class="scroll-wrapper">
                        <div class="json-card">
                            <ngx-json-viewer [json]="imageFeature"></ngx-json-viewer>
                        </div>
                    </div>
                </div>
                <div class="results">
                    <label>Analysis Results</label>
                    <div class="scroll-wrapper">
                        <div class="json-card">
                            <ngx-json-viewer [json]="analysisResult"></ngx-json-viewer>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="parameters">
    <div class="header">
        <label>Runtime parameters of ingester and monitor</label>
    </div>
    <div class="row-container">
        <div class="left">
            <div class="top">
                <label class="name">INGESTER</label>
                <div class="button">
                    <button class="top" (click)="onIngesterSync()">Sync</button>
                    <button class="top" [disabled]="!ingesterCheckAll()" (click)="onIngesterUpdateAll()">
                        Update All
                    </button>
                </div>
                <label class="status" [style.color]="ingesterStatusColor">{{ ingesterStatusText }}</label>
            </div>
            <div class="down">
                <table>
                    <tr>
                        <th class="col1">Parameter</th>
                        <th class="col2">Current</th>
                        <th class="col3">Change</th>
                        <th class="col4">Action</th>
                    </tr>
                    <tr>
                        <td class="col1">Run Number</td>
                        <td class="col2">{{ ingesterCurrent.runNumber }}</td>
                        <td class="col3"><input [(ngModel)]="ingesterChange.runNumber" /></td>
                        <td class="col4"><button [disabled]="!ingesterCheckRunNumber()">Update</button></td>
                    </tr>
                    <tr>
                        <td class="col1">Double Param</td>
                        <td class="col2">{{ ingesterCurrent.doubleParam }}</td>
                        <td class="col3"><input [(ngModel)]="ingesterChange.doubleParam" /></td>
                        <td class="col4"><button [disabled]="!ingesterCheckDoubleParam()">Update</button></td>
                    </tr>
                    <tr>
                        <td class="col1">Integer Param</td>
                        <td class="col2">{{ ingesterCurrent.integerParam }}</td>
                        <td class="col3"><input [(ngModel)]="ingesterChange.integerParam" /></td>
                        <td class="col4"><button [disabled]="!ingesterCheckIntegerParam()">Update</button></td>
                    </tr>
                    <tr>
                        <td class="col1">String Param</td>
                        <td class="col2">{{ ingesterCurrent.stringParam }}</td>
                        <td class="col3"><input [(ngModel)]="ingesterChange.stringParam" /></td>
                        <td class="col4"><button [disabled]="!ingesterCheckStringParam()">Update</button></td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="right">
            <div class="top">
                <label class="name">MONITOR</label>
                <div class="button">
                    <button class="top" (click)="onMonitorSync()">Sync</button>
                    <button class="top" [disabled]="!monitorCheckAll()">Update All</button>
                </div>
                <label class="status" [style.color]="monitorStatusColor">{{ monitorStatusText }}</label>
            </div>
            <div class="down">
                <table>
                    <tr>
                        <th class="col1">Parameter</th>
                        <th class="col2">Current</th>
                        <th class="col3">Change</th>
                        <th class="col4">Action</th>
                    </tr>
                    <tr>
                        <td class="col1">Lower Energy Cut</td>
                        <td class="col2">{{ monitorCurrent.lowerEnergyCut }}</td>
                        <td class="col3"><input [(ngModel)]="monitorChange.lowerEnergyCut" /></td>
                        <td class="col4"><button [disabled]="!monitorCheckLowerEnergyCut()">Update</button></td>
                    </tr>
                    <tr>
                        <td class="col1">Upper Energy Cut</td>
                        <td class="col2">{{ monitorCurrent.upperEnergyCut }}</td>
                        <td class="col3"><input [(ngModel)]="monitorChange.upperEnergyCut" /></td>
                        <td class="col4"><button [disabled]="!monitorCheckUpperEnergyCut()">Update</button></td>
                    </tr>
                    <tr>
                        <td class="col1">Double Param</td>
                        <td class="col2">{{ monitorCurrent.doubleParam }}</td>
                        <td class="col3"><input [(ngModel)]="monitorChange.doubleParam" /></td>
                        <td class="col4"><button [disabled]="!monitorCheckDoubleParam()">Update</button></td>
                    </tr>
                    <tr>
                        <td class="col1">Integer Param</td>
                        <td class="col2">{{ monitorCurrent.integerParam }}</td>
                        <td class="col3"><input [(ngModel)]="monitorChange.integerParam" /></td>
                        <td class="col4"><button [disabled]="!monitorCheckIntegerParam()">Update</button></td>
                    </tr>
                    <tr>
                        <td class="col1">String Param</td>
                        <td class="col2">{{ monitorCurrent.stringParam }}</td>
                        <td class="col3"><input [(ngModel)]="monitorChange.stringParam" /></td>
                        <td class="col4"><button [disabled]="!monitorCheckStringParam()">Update</button></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</div>
